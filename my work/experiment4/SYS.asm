	.ORIG x2000
	ST R0 SAVER0
	ST R1 SAVER1
	ST R2 SAVER2
	ST R3 SAVER3
	ST R4 SAVER4
	ST R5 SAVER5
	AND R5 R5 #0
	ADD R5 R5 #10
	LD R4 MASK	;R4 MASK CHAR
;the code
	LDI R0 KBDR	;R0 CHAR
	LDI R1 KBSR	;R1 CONTENT IN KBSR
	AND R1 R1 R4
	STI R1 KBSR
ENTER	LDI R1 KBSR
	BRZP ENTER
	AND R1 R1 R4
	STI R1 KBSR
LOOP	LDI R2 DSR	;R2 CONTENT IN DSR
	BRZP LOOP
	STI R0 DDR
;	AND R2 R2 R4
;	STI R2 DSR
	ADD R5 R5 #-1
	BRP LOOP

	LD R0 LF
LOOPL	LDI R2 DSR
	BRZP LOOPL
	STI R0 DDR
;	AND R2 R2 R4
;	STI R2 DSR

	LD R0 SAVER0
	LD R1 SAVER1
	LD R2 SAVER2
	LD R3 SAVER3
	LD R4 SAVER4
	LD R5 SAVER5
	ADD R5 R5 #0
	BRZ TOH
	AND R5 R5 #0
	BRNZP EXIT
TOH	ADD R5 R5 #1
EXIT	RTI

;buffer space as required
LF	.FILL x0A
KBSR	.FILL xFE00
KBDR	.FILL xFE02
DSR	.FILL xFE04
DDR	.FILL xFE06
MASK	.FILL x7FFF
SAVER0	.BLKW 1
SAVER1	.BLKW 1
SAVER2	.BLKW 1
SAVER3	.BLKW 1
SAVER4	.BLKW 1
SAVER5	.BLKW 1
	.END